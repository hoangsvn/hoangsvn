name: Clone and Build APKs from Latest Release

on:
    schedule:
        -   cron: '0 0 */7 * *'
    workflow_dispatch:

jobs:
    build-apks:
        runs-on: ubuntu-latest
        steps:
            -   name: Clone project t·ª´ repo g·ªëc
                run: |
                    git clone https://hoangsvn:${{ secrets.PRIVATE_REPO_TOKEN }}@github.com/hoangsvn/Touch.git project
                    cd project
            -   name: Set up JDK
                uses: actions/setup-java@v3
                with:
                    distribution: 'temurin'
                    java-version: '17'
            
            -   name: Build APKs
                run: |
                    cd project
                    chmod +x gradlew
                    ./gradlew build
            
            -   name: Copy APKs to root for commit
                run: |
                    mkdir -p apk
                    find project/app/build/outputs/apk -name "*.apk" -exec cp {} apk/ \;
            -   name: Xo√° th∆∞ m·ª•c project/
                run: |
                    echo "üßπ Xo√° source code project..."
                    rm -rf project
            -   name: C·∫•u h√¨nh Git
                run: |
                    git config user.name "${{ secrets.USER_NAME }}"
                    git config user.email "${{ secrets.EMAIL }}"
            -   name: Commit & Push APKs
                run: |
                    git add .
                    git commit -m "Update built APKs"
                    git push https://x-access-token:${{ secrets.GITHUB_TOKEN }}@github.com/${{ github.repository }} HEAD:main
