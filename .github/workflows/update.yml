name: Fetch All APKs from Latest Release

on:
    schedule:
        -   cron: '0 0 */7 * *'
    workflow_dispatch:

jobs:
    fetch-all-apks:
        runs-on: ubuntu-latest
        steps:
            -   name: Checkout repo chÃ­nh
                uses: actions/checkout@v3
            -   name: Get release info and extract APK URLs
                id: get_apks
                run: |
                    echo "Láº¥y thÃ´ng tin release..."
                    curl -L \
                          -H "Accept: application/vnd.github+json" \
                          -H "Authorization: Bearer ${{ secrets.PRIVATE_REPO_TOKEN }}" \
                          -H "X-GitHub-Api-Version: 2022-11-28" \
                          https://api.github.com/repos/hoangsvn/Touch/releases/latest > release.json
                    echo "Táº¡o danh sÃ¡ch APK URLs..."
                    cat release.json
                    jq -r '.assets[] | select(.name | endswith(".apk")) | .browser_download_url' release.json > apk_urls.txt
                    cat apk_urls.txt
            -   name: Download all APK files
                run: |
                    echo "Báº¯t Ä‘áº§u táº£i APKs..."
                    mkdir -p apk
                    while read url; do
                    while read url; do
                    name=$(basename "$url")
                    echo "Táº£i $name"
                    if [ -f "apk/$name" ]; then
                        echo "ðŸ§¹ XÃ³a file cÅ©: apk/$name"
                        rm -f "apk/$name"
                    fi
                    curl -L "$url" \
                         -H "Authorization: Bearer ${{ secrets.PRIVATE_REPO_TOKEN }}" \
                         -o "apk/$name"
                    done < apk_urls.txt
            -   name: Cáº¥u hÃ¬nh Git
                run: |
                    git config user.name ${{ secrets.USER_NAME }}
                    git config user.email ${{ secrets.EMAIL }}
            -   name: Commit & Push APKs
                run: |
                    git add .
                    git commit -m "Update APKs from latest release"
                    git push https://x-access-token:${{ secrets.GITHUB_TOKEN }}@github.com/${{ github.repository }} HEAD:main